/* Navgoco Menus - v0.1.0 - 2013-07-05
* https://github.com/tefra/navgoco
* Copyright (c) 2013 Chris T; Licensed BSD */
!function(a){"use strict";var b=function(b,c,d){return this.el=b,this.$el=a(b),this.opts=c,this.uuid=this.$el.attr("id")?this.$el.attr("id"):d,this.init(),this};b.prototype={init:function(){var b=this;if(b.opts.save)var c=b._load();b.$el.find("ul").each(function(d){var e=a(this);e.data("index",d),b.opts.save&&c.hasOwnProperty(d)?(e.parent().addClass(b.opts.openClass),e.show()):e.parent().hasClass(b.opts.openClass)?e.show():e.hide()});var d=b.$el.find("li:has(ul) > a");b.opts.caret&&d.append(b.opts.caret),d.click(function(c){c.preventDefault();var d=a(this).next(),e=d.is(":visible");b._toggle(d,e),b.opts.accordion?b._accordion(d):b.opts.save&&b._update(d,!e,!0)})},_toggle:function(a,b){b?(a.parent().removeClass(this.opts.openClass),a.slideUp(this.opts.slide)):(a.parent().addClass(this.opts.openClass),a.slideDown(this.opts.slide))},_accordion:function(b){var c=this,d={};d[b.data("index")]=!0,b.parent().parents("ul").each(function(){d[a(this).data("index")]=!0}),c.$el.find("ul:visible").each(function(){var b=a(this);d.hasOwnProperty(b.data("index"))||(b.parent().removeClass(c.opts.openClass),b.slideUp(c.opts.slide))})},_update:function(a,b,d){var e=a.data("index");b?c[this.uuid][e]=1:delete c[this.uuid][e],d&&this._save()},_save:function(){a.cookie(this.opts.cookie.name,JSON.stringify(c),this.opts.cookie)},_load:function(){if(null===c){var b=a.cookie(this.opts.cookie.name);c=b?JSON.parse(b):{}}return c.hasOwnProperty(this.uuid)||(c[this.uuid]={}),c[this.uuid]},collapse:function(){var b=this;b.$el.find("ul").each(function(){b._toggle(a(this),!0)}),b.opts.save&&(c[b.uuid]={},b._save())},expand:function(){var b=this,c=b.$el.find("ul");c.each(function(){var c=a(this);b._toggle(c,!1),b.opts.save&&b._update(c,!0,!1)}),b.opts.save&&b._save()}};var c=null,d={caret:'<span class="caret"></span>',accordion:!1,openClass:"open",save:!0,cookie:{name:"navgoco",expires:!1,path:"/"},slide:{duration:400,easing:"swing"}};a.fn.navgoco=function(c){var e="string"==typeof c;return e||(c=a.extend({},d,c||{}),(c.accordion||!a.cookie)&&(c.save=!1)),this.each(function(d){var f=a(this),g=f.data("navgoco");e&&g?g[c]():g||f.data("navgoco",new b(this,c,d))})}}(jQuery);